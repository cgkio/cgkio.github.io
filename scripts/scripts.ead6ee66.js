"use strict";angular.module("MyApp",["ionic","firebase","MyApp.services","MyApp.directives","MyApp.controllers"]).config(["$stateProvider","$urlRouterProvider",function(a,b){var c={auth:function(a,b){return a.getCurrentUser().then(b.loadCurrentUser)}};a.state("app",{url:"/app","abstract":!0,templateUrl:"views/sidemenu/sidemenu.html",controller:"SideMenuCtrl"}).state("signup",{url:"/signup",templateUrl:"views/signup/signup.html",controller:"SignupCtrl"}).state("login",{url:"/login",templateUrl:"views/login/login.html",controller:"LoginCtrl"}).state("change-password",{url:"/change-password",templateUrl:"views/change-password/change-password.html",controller:"ChangePasswordCtrl",resolve:c}).state("reset-password",{url:"/reset-password",templateUrl:"views/reset-password/reset-password.html",controller:"ResetPasswordCtrl"}).state("app.dashboard",{url:"/dashboard",views:{menuContent:{templateUrl:"views/dashboard/dashboard.html",controller:"DashboardCtrl",resolve:c}}}),b.otherwise("/login")}]).run(["$rootScope","$state","$ionicPlatform",function(a,b,c){c.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault(),a.$on("$stateChangeError",function(){b.go("login")})})}]).constant("FIREBASE_ROOT","https://aoc.firebaseio.com"),angular.module("MyApp.services",[]),angular.module("MyApp.directives",[]),angular.module("MyApp.controllers",[]),angular.module("MyApp.services").service("Auth",["$q","FIREBASE_ROOT","$firebaseSimpleLogin",function(a,b,c){var d=this,e=c(new Firebase(b));this.currentUser=null,this.getCurrentUser=function(){var b=a.defer();return e.$getCurrentUser().then(function(a){d.currentUser=a,null===a?b.reject():b.resolve(a)}),b.promise},this.createUser=function(b,c){var f=a.defer();return e.$createUser(b,c).then(function(a){d.currentUser=a,f.resolve(a)},function(a){d.currentUser=null,f.reject(a)}),f.promise},this.login=function(b,c){var f=a.defer();return e.$login("password",{email:b,password:c}).then(function(a){d.currentUser=a,f.resolve(a)},function(a){d.currentUser=null,f.reject(a)}),f.promise},this.logout=function(){e.$logout(),this.currentUser=null},this.sendPasswordResetEmail=function(a){return e.$sendPasswordResetEmail(a)},this.changePassword=function(a,b){return e.$changePassword(this.currentUser.email,a,b)}}]),angular.module("MyApp.services").service("User",["$q","$firebase","FIREBASE_ROOT","Auth",function(a,b,c,d){var e=new Firebase(c+"/users"),f=null;this.loadCurrentUser=function(){var c=a.defer(),g=e.child(d.currentUser.uid);return f=b(g),f.$on("loaded",c.resolve),c.promise},this.create=function(a,c){var d=b(e);return d.$child(a).$set({email:c})},this.recordPasswordChange=function(){var a=Math.floor(Date.now()/1e3);return f.$update({passwordLastChangedAt:a})},this.hasChangedPassword=function(){return angular.isDefined(f.passwordLastChangedAt)}}]),angular.module("MyApp.services").service("Signup",function(){this.randomPassword=function(){for(var a="abdfhijkprstuvwxyzACGHJKLMNPQRUVWXY34679",b=a.length,c="",d=0;10>d;d++)c+=a[Math.floor(b*Math.random())];return c}}),angular.module("MyApp.controllers").controller("SideMenuCtrl",["$scope","$state","Auth",function(a,b,c){a.logout=function(){c.logout(),b.go("login")}}]),angular.module("MyApp.controllers").controller("SignupCtrl",["$scope","$q","$state","$ionicLoading","Auth","User","Signup",function(a,b,c,d,e,f,g){function h(){return e.createUser(a.user.email,n)}function i(a){var c=b.defer();return e.sendPasswordResetEmail(a.email).then(function(){c.resolve(a)}),c.promise}function j(a){return e.login(a.email,n)}function k(a){return f.create(a.uid,a.email)}function l(){d.hide(),c.go("change-password")}function m(b){switch(b.code){case"INVALID_EMAIL":a.errorMessage="Invalid email";break;case"EMAIL_TAKEN":a.errorMessage="Email already exists";break;default:a.errorMessage="Error: ["+b.code+"]"}d.hide()}var n=g.randomPassword();a.user={email:""},a.errorMessage=null,a.signup=function(){a.errorMessage=null,d.show({template:"Please wait..."}),h().then(i).then(j).then(k).then(l).catch(m)}}]),angular.module("MyApp.controllers").controller("ChangePasswordCtrl",["$scope","$state","$ionicLoading","Auth","User",function(a,b,c,d,e){function f(){c.hide(),b.go("app.dashboard")}function g(b){switch(b.code){case"INVALID_PASSWORD":a.errorMessage="Invalid password";break;default:a.errorMessage="Error: ["+b.code+"]"}c.hide()}var h=/^(?=.*[A-Z])(?=.*[0-9])(?=.*[a-z]).{8,}$/;a.user={oldPassword:"",newPassword:""},a.passwordValid=!0,a.errorMessage=null,a.isFirstPasswordChange=!e.hasChangedPassword(),a.isFirstPasswordChange?(a.passwordLabel="Temporary Password",a.passwordPlaceholder="You'll find it in the email we sent you"):(a.passwordLabel="Current Password",a.passwordPlaceholder="Your current password"),a.done=function(){a.passwordValid=h.test(a.user.newPassword),a.passwordValid&&(a.errorMessage=null,c.show({template:"Please wait..."}),d.changePassword(a.user.oldPassword,a.user.newPassword).then(e.recordPasswordChange).then(f).catch(g))}}]),angular.module("MyApp.controllers").controller("ResetPasswordCtrl",["$scope","$ionicLoading","Auth",function(a,b,c){function d(){a.emailSent=!0,b.hide()}function e(c){switch(c.code){case"INVALID_EMAIL":case"INVALID_USER":a.errorMessage="Invalid email";break;default:a.errorMessage="Error: ["+c.code+"]"}b.hide()}a.user={email:""},a.errorMessage=null,a.resetPassword=function(){a.errorMessage=null,b.show({template:"Please wait..."}),c.sendPasswordResetEmail(a.user.email).then(d).catch(e)}}]),angular.module("MyApp.controllers").controller("LoginCtrl",["$scope","$state","$ionicLoading","Auth","User",function(a,b,c,d,e){function f(){c.hide(),b.go(e.hasChangedPassword()?"app.dashboard":"change-password")}function g(b){switch(b.code){case"INVALID_EMAIL":case"INVALID_PASSWORD":case"INVALID_USER":a.errorMessage="Email or password is incorrect";break;default:a.errorMessage="Error: ["+b.code+"]"}c.hide()}a.user={email:"",password:""},a.errorMessage=null,a.login=function(){a.errorMessage=null,c.show({template:"Please wait..."}),d.login(a.user.email,a.user.password).then(e.loadCurrentUser).then(f).catch(g)}}]),angular.module("MyApp.controllers").controller("DashboardCtrl",function(){});